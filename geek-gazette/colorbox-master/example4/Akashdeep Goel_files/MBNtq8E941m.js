/*!CK:4031184172!*//*1432002114,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["2DvFX"]); }

__d("TimelinePageLoadParam",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={REQUEST_PARAM_NAME:"tipld",LAST_RANKED_UNIT_TIME:"rt",REPORT_UNIT_COUNT:"rc",STORY_UNIT_COUNT:"sc",VISIBLE_UNIT_COUNT:"vc"};},null);
__d("ComposerXEmptyAttachment",["ComposerXAttachment"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l){"use strict";g.call(this);this._root=k;if(l)this.attachmentClassName=l;}j.prototype.getRoot=function(){"use strict";return this._root;};e.exports=j;},null);
__d("onViewportChanged",["EventListener","emptyFunction","getViewportDimensions","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=[],l=false,m=null,n,o;function p(){var aa=i.withoutScrollbars();return {top:0,bottom:aa.height,left:0,right:aa.width};}function q(aa,ba){var ca={transform:ba||h.thatReturnsArgument,callback:aa,needsUpdate:true};k.push(ca);x();s();return {remove:r.bind(null,ca),scheduleCheck:v.bind(null,ca)};}function r(aa){var ba=k.indexOf(aa);if(ba!==-1){k.splice(ba,1);if(k.length===0){t();m=null;}}}function s(){if(!o){o=g.listen(window,'scroll',w);n=g.listen(window,'resize',u);}}function t(){if(o){o.remove();n.remove();o=n=null;}}function u(){m=null;w();}function v(aa){aa.needsUpdate=true;x();}function w(){k.map(function(aa){return aa.needsUpdate=true;});x();}function x(){if(!l){l=true;j(function(){l=false;z();});}}function y(aa){if(aa.needsUpdate){aa.needsUpdate=false;return true;}return false;}function z(){if(!m)m=p();var aa=k.filter(y),ba=aa.map(function(ca){return ca.transform.call(null,m);});aa.forEach(function(ca,da){return ca.callback.call(null,ba[da]);});}e.exports=q;},null);
__d("onRectIsWithinViewport",["onViewportChanged"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(j,k){return !(j.bottom<k.top||j.top>k.bottom||j.right<k.left||j.left>k.right);}function i(j,k){var l;function m(o){var p=j();return !!p&&h(p,o);}function n(o){if(l!==o){l=o;k(o);}}return g(n,m);}e.exports=i;},null);
__d("OnVisible.react",["React","getElementRect","onRectIsWithinViewport","onlyChild"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g,l=k.PropTypes,m=g.createClass({displayName:"OnVisible",propTypes:{onVisible:l.func,onHidden:l.func,buffer:l.number},componentDidMount:function(){this._createListener();},componentDidUpdate:function(){this._createListener();},componentWillUnmount:function(){this._removeListener();},reset:function(){this._removeListener();this._createListener();},check:function(){if(this._listener)this._listener.scheduleCheck();},_measureElementRect:function(){if(!this.isMounted())return null;var n=this.props.buffer||0,o=h(g.findDOMNode(this));o.left-=n;o.right+=n;o.top-=n;o.bottom+=n;return o;},_createListener:function(){var n=g.findDOMNode(this);if(this._listener&&n!==this._element)this._removeListener();if(!this._listener){this._element=n;this._listener=i(this._measureElementRect,function(o){var p=o?this.props.onVisible:this.props.onHidden;p&&p();}.bind(this));}},_removeListener:function(){if(this._listener){this._listener.remove();this._listener=null;}},render:function(){return j(this.props.children);}});e.exports=m;},null);
__d("ProfileInfoRequestNoteFlyout",["CSS","csx","DOM","Event","LayerDestroyOnHide","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o){"use strict";this.$ProfileInfoRequestNoteFlyout0=o;this.$ProfileInfoRequestNoteFlyout1=i.scry(this.$ProfileInfoRequestNoteFlyout0.getContentRoot(),"._958")[0];l(j.listen(n,'click',this.$ProfileInfoRequestNoteFlyout2.bind(this)));l(this.$ProfileInfoRequestNoteFlyout0.subscribe('success',this.$ProfileInfoRequestNoteFlyout3.bind(this)));l(this.$ProfileInfoRequestNoteFlyout0.subscribe('hide',this.$ProfileInfoRequestNoteFlyout4.bind(this)));l(this.$ProfileInfoRequestNoteFlyout0.subscribe('error',this.$ProfileInfoRequestNoteFlyout5.bind(this)));}m.prototype.$ProfileInfoRequestNoteFlyout2=function(n){"use strict";this.$ProfileInfoRequestNoteFlyout0.show();n.kill();};m.prototype.$ProfileInfoRequestNoteFlyout5=function(n,o){"use strict";i.setContent(this.$ProfileInfoRequestNoteFlyout1,o.response.errorDescription);g.show(this.$ProfileInfoRequestNoteFlyout1);return false;};m.prototype.$ProfileInfoRequestNoteFlyout4=function(){"use strict";g.hide(this.$ProfileInfoRequestNoteFlyout1);};m.prototype.$ProfileInfoRequestNoteFlyout3=function(){"use strict";this.$ProfileInfoRequestNoteFlyout0.enableBehavior(k);this.$ProfileInfoRequestNoteFlyout0.hide();};e.exports=m;},null);
__d("TimelineLoadState",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={NOT_LOADED:0,LOADING:1,LOADED:2};e.exports=g;},null);
__d("TimelineSectionStore",["TimelinePageLoadParam","KeyedCallbackManager","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=new h(),k='num_reports_tried',l='num_reports_visible',m='more_pager_data',n='finished',o={getDataToLoadNextSegment:function(p,q){j.executeOrEnqueue(p,function(r){this._mergeReportsAndStoriesDataCallback(r,q);}.bind(this));},setSectionFinished:function(p,q){var r=this._getSectionData(p);if(!r[n])r[n]={};r[n][q]=true;j.setResource(p,r);if(r[n].stories&&r[n].reports)this.emitAndHold('section_finished',p);},setReportsData:function(p,q,r){var s=this._getSectionData(p);s[k]=q;s[l]=r;j.setResource(p,s);},setStoriesData:function(p,q){var r=this._getSectionData(p);r[m]=q;j.setResource(p,r);},_getSectionData:function(p){var q=j.getResource(p);return q||{};},_mergeReportsAndStoriesDataCallback:function(p,q){var r=p[m];if(!r.hasOwnProperty(g.REQUEST_PARAM_NAME))r[g.REQUEST_PARAM_NAME]={};r[g.REQUEST_PARAM_NAME][g.REPORT_UNIT_COUNT]=p[k];var s=r[g.REQUEST_PARAM_NAME][g.VISIBLE_UNIT_COUNT];r[g.REQUEST_PARAM_NAME][g.VISIBLE_UNIT_COUNT]=s+p[l];q(r);}};i(o,{section_finished:true});e.exports=o;},null);
__d("TimelineSectionPager.react",["Arbiter","DataStore","Link.react","React","ReactComponentWithPureRenderMixin","TimelineConstants","TimelineLegacySections","TimelineLoadState","TimelineSectionStore","UIPagelet","FeedPlaceHolderStory.react","OnVisible.react","$","cx","keyMirror"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=j,w=v.PropTypes,x=null,y={},z=u({LINK:null,LOADING:null,ON_VISIBLE:null}),aa=500,ba=j.createClass({displayName:"TimelineSectionPager",_storeListener:x,_sectionLoadSubscription:x,mixins:[k],propTypes:{loadMoreLabel:w.string.isRequired,sectionKey:w.string.isRequired,rootID:w.string.isRequired},componentWillMount:function(){y[this.props.sectionKey]=this;this._storeListener=o.addListener('section_finished',this._handleSectionFinished);this._sectionLoadSubscription=g.subscribe(l.SECTION_FULLY_LOADED,this._handleSectionLoad);},getInitialState:function(){return {buffer:aa,pagerState:z.ON_VISIBLE};},render:function(){if(this.state.pagerState===z.LINK)return (j.createElement(i,{className:"_3g20",onClick:this._onPagerClick},this.props.loadMoreLabel));var ca=j.createElement(q,{className:"_lr_"});if(this.state.pagerState===z.LOADING)return ca;return (j.createElement(r,{buffer:this.state.buffer,onVisible:this._loadNextSegment},ca));},componentWillUnmount:function(){this._storeListener.remove();this._sectionLoadSubscription.unsubscribe();y[this.props.sectionKey]=null;},statics:{getInstance:function(ca){return y[ca];}},removeOnVisible:function(){this.setState({pagerState:z.LINK});},restoreOnVisible:function(){this.setState({pagerState:z.ON_VISIBLE});},unmount:function(){j.unmountComponentAtNode(s(this.props.rootID));},_onPagerClick:function(){var ca=m.get(this.props.sectionKey);if(ca)ca.activateContentScrollLoad();this._loadNextSegment();},_loadNextSegment:function(){var ca=m.get(this.props.sectionKey);if(ca&&ca.hasPendingCallbacks()){ca.runPendingDisplayCallbacks();this._onLoadComplete();}else this.setState({pagerState:z.LOADING},function(){return o.getDataToLoadNextSegment(this.props.sectionKey,this._nextSegmentDataHandler);}.bind(this));},_nextSegmentDataHandler:function(ca){var da=m.get(this.props.sectionKey);if(da){this._loadPagelet(ca);return;}var ea=g.subscribe(l.SECTION_REGISTERED,function(fa,ga){if(ga.scrubberKey===this.props.sectionKey){this._loadPagelet(ca);ea.unsubscribe();}}.bind(this));},_loadPagelet:function(ca){var da=ca.page_index,ea=m.get(this.props.sectionKey);if(!ea)return;var fa=ea.getPageLoadStatus(da);if(fa!==n.NOT_LOADED){this._enableNextPage();return;}var ga=function(ia){return this._pageletDisplay(da,ia);}.bind(this),ha={append:true,constHeight:true,crossPage:true,displayCallback:ga,finallyHandler:this._onLoadComplete,jsNonblock:true,usePipe:true};ea.setPageLoadStatus(da,n.LOADING);p.loadFromEndpoint('ProfileTimelineSectionPagelet',ca.unit_container_id,ca,ha);},_handleSectionFinished:function(ca){if(ca===this.props.sectionKey)this.unmount();},_handleSectionLoad:function(ca,da){if(da.scrubberKey===this.props.sectionKey){var ea=m.get(this.props.sectionKey),fa=0;if(ea&&!ea.isRightColumnFinished())fa=h.get(l.DS_COLUMN_HEIGHT_DIFFERENTIAL,this.props.sectionKey);this.setState({buffer:Math.abs(fa)+aa});}},_canScrollLoad:function(){var ca=m.get(this.props.sectionKey);return !!ca&&ca.canContentScrollLoad();},_onLoadComplete:function(){if(this.isMounted())this._enableNextPage();},_enableNextPage:function(){this.setState({pagerState:this._canScrollLoad()?z.ON_VISIBLE:z.LINK});},_pageletDisplay:function(ca,da){var ea=m.get(this.props.sectionKey);if(ea){ea.setPageLoadStatus(ca,n.LOADED);if(ea.canContentScrollLoad()){da();}else ea.queueDisplayCallback(ca,da);}}});e.exports=ba;},null);
__d("TimelineUnitSelector",["DOMQuery","csx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={getUnitsWithTime:function(j){return g.scry(j,"._5jmm[data-time]");}};e.exports=i;},null);
__d("TimelineComposerUtilities",["Event","Arbiter","Bootloader","CSS","DOM","DOMQuery","Parent","TimelineUnitSelector","Vector","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=86400*31,r=86400000,s={listenToSetEstimatedDate:function(t,u){return h.subscribe('ComposerXTimelineTagger/init',function(v,w){if(l.contains(t,w.datePickerElement)){s.setEstimatedDate(w.datePickerInstance,u());w.composerTimelineTagger.switchToTagger('date');}});},listenToPublish:function(t,u){if(t.root)t=t.root;return h.subscribe('composer/publish',function(event,v){if(v.composer_id===t.id)i.loadModules(["TimelineStoryPublisher"],function(w){w.publish(v);u&&u();});});},listenToAnotherComposerOpen:function(t,u){return h.subscribe('composer/mutate',function(v,w){if(w!==t)u();});},listenToCancel:function(t,u){return g.listen(t,'click',function(event){if(m.byClass(event.getTarget(),"_306"))u();});},setEstimatedDate:function(t,u){var v,w;if(u&&j.hasClass(u,'fbTimelineCapsule')){v=u.getAttribute('data-start');w=u.getAttribute('data-end');if(v&&w){var x=new Date(w*1000),y=new Date();if(x>y){t.setDate(y.getFullYear(),y.getMonth()+1,y.getDate());}else if(w-v>2*q){t.setDate(x.getFullYear());}else t.setDate(x.getFullYear(),x.getMonth()+1);}return;}var z=m.byClass(u,'fbTimelineCapsule');if(z){v=z.getAttribute('data-start');w=z.getAttribute('data-end');var aa=o.getElementPosition(u).y,ba=[w,null],ca=[v,null],da=n.getUnitsWithTime(z);for(var ea=0;ea<da.length;ea++){var fa=da[ea],ga=k.scry(fa.parentNode,'.spinePointer')[0];if(!ga)continue;var ha=o.getElementPosition(ga).y;if(ha<=aa){if(!ba[1]||ha>ba[1])ba=[fa.getAttribute('data-time'),ha];}else if(!ca[1]||ha<ca[1])ca=[fa.getAttribute('data-time'),ha];}if(ba[0]!==null&&ca[0]!==null){var ia=Math.round((parseInt(ba[0],10)+parseInt(ca[0],10))/2)*1000;ia=Math.min(new Date()-r,ia);t.setDateWithTimestamp(ia);}}}};e.exports=s;},null);
__d("TimelineSection",["Arbiter","CSS","DOM","Parent","ScrollingPager","TimelineConstants","TimelineLegacySections","TimelineLoadState","TimelineScrubberKey","UIPagelet","TimelineSectionPager.react","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(t,u,v,w,x){"use strict";this.$TimelineSection0=t;this.$TimelineSection1=w;this.$TimelineSection2=u;this.$TimelineSection3=null;this.$TimelineSection4=null;this.$TimelineSection5=true;this.$TimelineSection6=true;this.$TimelineSection7=u!==o.RECENT_ACTIVITY;this.$TimelineSection8=x;this.$TimelineSection9=v;this.$TimelineSectiona={};this.$TimelineSectionb=false;this.$TimelineSectionc=[];this.$TimelineSectiond=false;this.$TimelineSectione=[];}s.prototype.load=function(t,u){"use strict";if(this.$TimelineSection1){this.activateContentScrollLoad();return;}var v=this.$TimelineSection9;g.inform(l.SECTION_LOADING,{data:v,scrubberKey:this.$TimelineSection2});this.$TimelineSection1=true;h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');var w='ProfileTimelineSectionPagelet',x=this.$TimelineSection2===o.WAY_BACK;if(x)w='ProfileTimelineRemainingYearsPagelet';var y=m.shouldForceNoFriendActivity();v=r(v,{highlight_unit_data:t,parent_key:this.$TimelineSection3,force_no_friend_activity:y});h.addClass(this.$TimelineSection0,'fbTimelineSectionLoading');this.$TimelineSection5=false;this.activateContentScrollLoad();var z=null;if(u){this.$TimelineSection0.style.minHeight=window.innerHeight+'px';z=function(){this.$TimelineSection0.style.minHeight='';m.destroyOnVisible(this.$TimelineSection2);}.bind(this);}m.addLoadPagelet(this.$TimelineSection2,p.loadFromEndpoint(w,this.$TimelineSection0.id,v,{usePipe:true,jsNonblock:true,constHeight:true,append:false,finallyHandler:z}));m.collapsePlaceHolderHeaders();};s.prototype.preload=function(){"use strict";h.addClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');var t=i.find(this.$TimelineSection0,'span.sectionLabel');if(t.getAttribute('data-original-label')){i.setContent(t,t.getAttribute('data-original-label'));t.removeAttribute('data-original-label');}};s.prototype.unload=function(){"use strict";if(!this.$TimelineSection1||!this.$TimelineSection7)return;this.$TimelineSection1=false;m.cancelLoadPagelet(this.$TimelineSection2);h.addClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');if(this.$TimelineSection0.nextSibling&&h.hasClass(this.$TimelineSection0.nextSibling,'fbTimelineSection')){i.setContent(this.$TimelineSection0,this.$TimelineSection0.nextSibling);h.show(this.$TimelineSection0.firstChild);}else i.empty(this.$TimelineSection0);this.deactivateScrollLoad();};s.prototype.canScrollLoad=function(){"use strict";return this.$TimelineSection5;};s.prototype.activateScrollLoad=function(){"use strict";this.$TimelineSection5=true;h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');h.addClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');var t=m.getOnVisible(this.$TimelineSection2);if(t)t.reset();return this;};s.prototype.deactivateScrollLoad=function(){"use strict";if(!this.$TimelineSection1){this.$TimelineSection5=false;h.removeClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded');h.addClass(this.$TimelineSection0,'fbTimelineTimePeriodSuppressed');var t=m.getOnVisible(this.$TimelineSection2);if(t)t.remove();}i.scry(this.$TimelineSection0,'.fbTimelineSectionExpandPager').forEach(function(u){var v=k.getInstance(u.id);v&&v.removeOnVisible();var w=j.byClass(u,'stat_elem');if(w)h.removeClass(w,'async_saving');});return this;};s.prototype.canContentScrollLoad=function(){"use strict";return this.$TimelineSection6;};s.prototype.activateContentScrollLoad=function(){"use strict";this.$TimelineSection6=true;var t=q.getInstance(this.$TimelineSection2);if(t)t.restoreOnVisible();return this;};s.prototype.deactivateContentScrollLoad=function(){"use strict";this.$TimelineSection6=false;var t=q.getInstance(this.$TimelineSection2);if(t)t.removeOnVisible();return this;};s.prototype.removeSectionPager=function(){"use strict";var t=q.getInstance(this.$TimelineSection2);if(t)t.unmount();return this;};s.prototype.getNode=function(){"use strict";return this.$TimelineSection0;};s.prototype.getScrubberKey=function(){"use strict";return this.$TimelineSection2;};s.prototype.getParentKey=function(){"use strict";return this.$TimelineSection3;};s.prototype.setParentKey=function(t){"use strict";this.$TimelineSection3=t;return this;};s.prototype.addSubSection=function(t,u){"use strict";if(!Array.isArray(this.$TimelineSection4))this.$TimelineSection4=[];if(Array.isArray(this.$TimelineSection4))this.$TimelineSection4[t]=u;return this;};s.prototype.getSubSections=function(){"use strict";return this.$TimelineSection4;};s.prototype.isLoaded=function(){"use strict";return this.$TimelineSection1;};s.prototype.isRightColumnFinished=function(){"use strict";return this.$TimelineSectionb;};s.prototype.setRightColumnFinished=function(){"use strict";this.$TimelineSectionb=true;return this;};s.prototype.getHistoricUnitCount=function(){"use strict";return this.$TimelineSection8;};s.prototype.setExpandLoadData=function(t){"use strict";this.$TimelineSectiona=t;return this;};s.prototype.expand=function(t){"use strict";if(!this.$TimelineSection1)return this;var u=i.find(this.$TimelineSection0,'.fbTimelineSectionExpander');h.addClass(u.firstChild,'async_saving');t&&h.addClass(t,'async_saving');g.inform(l.SECTION_EXPAND,this.$TimelineSection2);i.scry(this.$TimelineSection0,'.fbTimelineCapsule').forEach(i.remove);this.$TimelineSectiona.new_expand=true;m.cancelLoadPagelet(this.$TimelineSection2);m.addLoadPagelet(this.$TimelineSection2,p.loadFromEndpoint('ProfileTimelineSectionPagelet',u.id,this.$TimelineSectiona,{usePipe:true,jsNonblock:true,constHeight:true}));return this;};s.prototype.isPermalinkPeriod=function(){"use strict";return !!this.$TimelineSection9.is_permalink_period;};s.prototype.isHidden=function(){"use strict";return this.$TimelineSectiond;};s.prototype.hide=function(){"use strict";this.$TimelineSectiond=true;h.hide(i.find(this.$TimelineSection0,'.fbTimelineSection'));return this;};s.prototype.isHiddenFromView=function(){"use strict";return (!this.$TimelineSection1||this.$TimelineSectiond||h.hasClass(this.$TimelineSection0,'fbTimelineTimePeriodUnexpanded'));};s.prototype.hasPendingCallbacks=function(){"use strict";return this.$TimelineSectionc.length>0;};s.prototype.queueDisplayCallback=function(t,u){"use strict";this.$TimelineSectionc[t]=u;return this;};s.prototype.runPendingDisplayCallbacks=function(){"use strict";while(this.hasPendingCallbacks())this.$TimelineSectionc.shift()();return this;};s.prototype.setPageLoadStatus=function(t,u){"use strict";this.$TimelineSectione[t]=u;return this;};s.prototype.getPageLoadStatus=function(t){"use strict";if(this.$TimelineSectione[t]===(void 0))this.$TimelineSectione[t]=n.NOT_LOADED;return this.$TimelineSectione[t];};e.exports=s;},null);
__d("TimelineContentLoader",["Arbiter","CSS","DOM","DOMScroll","Event","OnVisible","Parent","ScrollingPager","TimelineComponentKeys","TimelineConstants","TimelineController","TimelineDOMID","TimelineLegacySections","TimelineScrubberKey","TimelineSection","TimelineSectionStore","TimelineSmartInsert","Vector","$","arrayContains","copyProperties","createArrayFromMixed","csx","debounce","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){b.__markCompiled&&b.__markCompiled();var fa=false,ga=null,ha={},ia={},ja=[],ka={},la=null,ma=null,na=null,oa=80,pa=250,qa=500;function ra(){if(fa)return;q.register(o.CONTENT,xa);ma=g.subscribe(p.SECTION_EXPAND,function(ya,za){xa.navigateToSection(za);});na=v.addRetroactiveListener('section_finished',ua);fa=true;}var sa=da(function(ya,za,ab){var bb=s.get(ya).getHistoricUnitCount();za-=bb;ab-=1;if(bb==-1||ab<=0||za<0)return;var cb=xa.getNextSectionKey(ya);if(cb){s.get(cb).load();sa(cb,za,ab);}},qa);function ta(ya,za){if(!za)za=0;if(za<oa&&!ya())setTimeout(ta.bind(null,ya,za+1),pa);}function ua(ya){ta(function(){if(ya===t.WAY_BACK)return true;var za=xa.getNextSectionKey(ya);if(za){wa(za);return true;}return false;});}function va(ya,za,ab){ta(function(){if(za===t.WAY_BACK)return true;var bb=xa.getNextSectionKey(za);if(bb){s.addOnVisible(bb,new l(ya,wa.bind(null,bb),false,ab||1000));return true;}return false;});}function wa(ya){var za=s.get(ya);if(za&&za.canScrollLoad()){za.load();if(la)sa(ya,la.required_units,la.max_parallelism);}}var xa={CURRENT_SECTION_OFFSET:150,registerTimePeriod:function(ya,za,ab,bb,cb,db,eb){ra();if(z(ja,za))return;if(ia)aa(ab,ia);var fb=new u(ya,za,ab,bb,eb);if(!cb){s.setMainSectionOrder(za,db);ha[za]=true;}else{fb.setParentKey(cb);var gb=s.get(cb);if(gb)gb.addSubSection(db,fb);}s.set(za,fb);xa.checkCurrentSectionChange();g.inform(p.SECTION_REGISTERED,{scrubberKey:za,section:fb});},reset:function(){s.removeAllOnVisibles();s.cancelLoadPagelets();for(var ya in ka){ka[ya].unsubscribe();delete ka[ya];}ma&&ma.unsubscribe();ma=null;na&&na.remove();na=null;s.removeAll();ga=null;ha={};ia={};ja=[];fa=false;},checkCurrentSectionChange:function(){var ya=xa.getCurrentSection(),za=ga&&ga.getScrubberKey();if(ya&&ya.getScrubberKey()!==za&&!ya.isPermalinkPeriod()){ga=ya;var ab=ya.getScrubberKey(),bb=ya.getParentKey();if(!bb){bb=ab;ab=null;}q.sectionHasChanged(bb,ab);}},setParallelLoadConfig:function(ya){la=ya;},getCurrentSection:function(){var ya={},za=s.getAll();for(var ab in za){var bb=za[ab];if(!bb||bb.isHiddenFromView())continue;var cb=x.getElementPosition(bb.getNode(),'viewport').y;if(bb.getScrubberKey()===t.RECENT_ACTIVITY)cb--;if(cb<xa.CURRENT_SECTION_OFFSET)ya[cb]=bb;}var db=Math.max.apply(null,Object.keys(ya)),eb=s.getMainSectionOrder(),fb=db==-Infinity;if(!fb){return ya[db];}else if(eb[0])return s.get(eb[0]);return null;},getLastVisibleSection:function(){var ya=s.getMainSectionOrder();for(var za=ya.length-1;za>=0;za--){var ab=s.get(ya[za]);if(ab&&!ab.isHiddenFromView())return ab;}return null;},getRecentActivitySection:function(){return s.get(t.RECENT_ACTIVITY);},capsuleForCurrentSection:function(){var ya=xa.getCurrentSection();return ya&&i.scry(ya.getNode(),'.fbTimelineCapsule')[0];},enableScrollLoad:function(ya,za,ab,bb){ya=y(ya);var cb=m.byClass(ya,'fbTimelineSection')||ya.parentNode,db=cb&&i.scry(cb,'.fbTimelineCapsule')[0];if(!db)return;if(ab===null){va(ya,za,bb);}else q.runOnceWhenSectionFullyLoaded(va.bind(null,ya,za,bb),za,ab);},expandSectionOnClick:function(ya,za){k.listen(ya,'click',function(ab){ab.prevent();s.get(za).expand();});},expandSubSectionsOnClick:function(ya,za){k.listen(ya,'click',function(ab){ab.prevent();s.cancelLoadPagelet(za);var bb=s.get(za),cb=bb.getSubSections();if(cb&&cb.length)xa.navigateToSection(cb[0].getScrubberKey());});},getNextSectionKey:function(ya){var za=s.getMainSectionOrder();for(var ab=0;ab<za.length-1;ab++)if(za[ab]==ya){while(ab<za.length-1&&!za[ab+1])ab++;return za[ab+1];}var bb=s.get(ya);if(!bb||!bb.getParentKey())return;var cb=s.get(bb.getParentKey());if(!cb)return;var db=cb.getSubSections();for(var eb=0;eb<db.length-1;eb++)if(db[eb].getScrubberKey()==ya)return db[eb+1].getScrubberKey();},hideSection:function(ya){var za=s.get(ya);if(za)za.hide();var ab=q.getCurrentScrubber();if(ab){var bb=null;if(!ha[ya]){bb=q.getCurrentScrubber().getSubnav(za.getParentKey(),ya);}else bb=q.getCurrentScrubber().getNav(ya);bb&&h.hide(bb);}var cb=q.getCurrentStickyHeaderNav();cb&&cb.removeTimePeriod(ya);},loadSectionOnClick:function(ya,za){k.listen(ya,'click',function(ab){ab.prevent();s.get(za).load();});},removeSection:function(ya){s.removeOnVisible(ya);s.remove(ya);delete ha[ya];var za=q.getCurrentStickyHeaderNav();za&&za.removeTimePeriod(ya);ja.push(ya);},removeSectionParent:function(ya){i.remove(y(ya).parentNode);},navigateToSection:function(ya,za,ab){za=!!za;var bb=ya,cb=s.get(ya);if(!cb)return;if(!cb.isLoaded()){w.enable();i.scry(y(r.TAB_CONTENT),'.fbTimelineShowOlderSections').forEach(i.remove);}if(!ha[ya]){if(!cb.isLoaded())cb.getNode().style.minHeight=x.getViewportDimensions().y+'px';var db=g.subscribe(p.SECTION_FULLY_LOADED,function(nb,ob){if(ob.scrubberKey===ya){cb.getNode().style.minHeight='';db.unsubscribe();}});bb=cb.getParentKey();var eb=s.get(bb);if(eb){var fb=eb.getNode();eb.removeSectionPager();if(!h.hasClass(fb,'fbTimelineSectionExpanded')){j.scrollTo(fb,0);h.addClass(fb,'fbTimelineSectionExpanded');i.scry(fb,'.fbTimelineCapsule').forEach(i.remove);i.scry(fb,'div.fbTimelineSectionExpandPager').forEach(i.remove);i.scry(fb,'div.fbTimelineContentHeader').forEach(i.remove);i.scry(fb,"._5vf").forEach(function(nb){if(!nb.getAttribute('data-subsection'))i.remove(nb);});}}var gb=xa.getNextSectionKey(bb),hb=s.getOnVisible(gb);if(hb)hb.setBuffer(0);}var ib=s.getMainSectionOrder();for(var jb=0;jb<ib.length;jb++){var kb=ib[jb];if(!kb)continue;if(kb==bb)break;s.get(kb).deactivateScrollLoad().deactivateContentScrollLoad();}cb.load(ab,true);s.collapsePlaceHolderHeaders();var lb=x.getScrollPosition().x,mb=x.getElementPosition(cb.getNode()).y;if(!za)j.scrollTo(new x(lb,mb-p.SCROLL_TO_OFFSET,'document'),true,false,false,0,function(){var nb=x.getElementPosition(cb.getNode()).y;j.scrollTo(new x(lb,nb-p.SCROLL_TO_OFFSET,'document'),false);var ob=i.scry(cb.getNode(),'h3.uiHeaderTitle')[0];if(ob){ob.tabIndex=0;ob.focus();}});},appendContentAfterLoad:function(ya,za,ab){q.runOnceWhenSectionFullyLoaded(i.appendContent.bind(null,y(ya),za),ab,'0');},markSectionAsLoaded:function(ya,za,ab){q.runOnceWhenSectionFullyLoaded(function(){ea(ya)&&h.removeClass(y(ya).parentNode,'fbTimelineSectionLoading');},za,ab);},suppressSectionsAbove:function(ya){var za,ab,bb=s.getMainSectionOrder();for(var cb=0;cb<bb.length;cb++){var db=bb[cb];if(!db)continue;za=s.get(db).getNode();ab=null;if(ba(ya.parentNode.children).indexOf(ya)<=ba(za.parentNode.children).indexOf(za)){ab=db;break;}s.get(db).deactivateScrollLoad();}if(ab)xa.navigateToSection(ab,true);},forceNoFriendActivity:function(){s.forceNoFriendActivity();},removeDupes:function(ya){var za=ea(ya);if(!za)return;var ab=i.scry(za,'li.fbTimelineUnit'),bb={};for(var cb=0;cb<ab.length;cb++){var db=ab[cb];if(db.id&&db.id.startsWith('tl_unit_')){var eb=db.id.substring(8,db.id.length),fb=i.scry(db,'div.timelineUnitContainer');if(fb.length>0)eb=eb+fb[0].getAttribute('data-time');if(bb.hasOwnProperty(eb)){db.id='dupe_unit_'+Math.random();db.className="hidden_elem";}else bb[eb]=1;}}},removeLoadingState:function(ya){ea(ya)&&h.removeClass(y(ya),'fbTimelineSectionLoading');},setExpandLoadDataForSection:function(ya,za){var ab=s.get(ya);ab&&ab.setExpandLoadData(za);},updatePagerAfterLoad:function(ya,za,ab,bb,cb){var db=n.getInstance(ya.firstChild.id);if(!db){ka[ya.firstChild.id]=g.subscribe(n.REGISTERED,function(fb,gb){ka[ya.firstChild.id].unsubscribe();delete ka[ya.firstChild.id];if(gb.id===ya.firstChild.id)xa.updatePagerAfterLoad(ya,za,ab,bb,cb);});return;}var eb=db.getHandler();db.setHandler(function(fb){h.addClass(ya,'async_saving');eb(fb);});q.runOnceWhenSectionFullyLoaded(function(){h.removeClass(ya,'fbTimelineHiddenPager');db.checkBuffer();},ab,bb);if(cb)q.runOnceWhenSectionFullyLoaded(q.adjustScrollingPagerBuffer.bind(null,ya.firstChild.id,ab),ab,bb);},repositionDialog:function(ya){g.subscribe(p.SECTION_LOADED,function(){ya.updatePosition();});},rightColumnFinished:function(ya){var za=s.get(ya);za.setRightColumnFinished();},addUnrankedUnits:function(ya){var za=y(ya),ab=i.scry(za,'li.fbTimelineUnit');for(var bb=ab.length-1;bb>=0;bb--){var cb=ab[bb];i.insertAfter(za,cb);h.addClass(i.find(cb,'div.timelineUnitContainer'),'fbTimelineHighlightUnit');}i.remove(za);},addUnrankedStories:function(ya){var za=y(ya),ab=i.scry(za,"._5pat");for(var bb=ab.length-1;bb>=0;bb--){var cb=ab[bb];i.insertAfter(za,cb);}i.remove(za);g.inform('Timeline/unrankedStoriesLoaded');}};e.exports=xa;},null);
__d("TimelineStickyHeaderComposerX",["Arbiter","Bootloader","ComposerXController","CSS","DOMQuery","Event","Parent","Run","TimelineComposerUtilities","TimelineContentLoader","TimelineStickyHeader","Vector","csx","cx","getElementText","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();function w(y){return y&&y.getContext&&m.byClass(y.getContext(),"_2wp");}function x(y){"use strict";this._composerRoot=y;this._tokens=[o.listenToSetEstimatedDate(this._composerRoot,p.capsuleForCurrentSection),o.listenToPublish(this._composerRoot,this._close.bind(this)),g.subscribe('PhotoSnowlift.OPEN',this._close.bind(this)),g.subscribe('TimelineMLE/mleFlyoutShown',function(z,aa){if(w(aa)===this._composerRoot)i.reset(this._composerRoot);}.bind(this)),g.subscribe('composer/initializedAttachment',function(z,aa){if(aa.composerRoot===this._composerRoot){this._registerClickToDismiss();if(!aa.isInitial)this._closeMLE();}else this._close();}.bind(this)),g.subscribe(q.ADJUST_WIDTH,this._toggleNarrowMode.bind(this))];this._clickCancelToken=o.listenToCancel(this._composerRoot,this._close.bind(this));n.onLeave(function(){while(this._tokens.length)this._tokens.pop().unsubscribe();this._clearClickDismissToken();if(this._clickCancelToken){this._clickCancelToken.remove();this._clickCancelToken=null;}}.bind(this));}x.prototype._toggleNarrowMode=function(event,y){"use strict";h.loadModules(["Tooltip"],function(z){var aa;v(function(){aa=r.getElementDimensions(y).x>400;},function(){var ba=k.scry(this._composerRoot,"._9lb");j.conditionClass(this._composerRoot,"_2wq",aa);for(var ca=0;ca<ba.length;ca++){var da=ba[ca],ea=u(da);if(aa){z.set(da,ea);}else z.remove(da);}}.bind(this));}.bind(this));return false;};x.prototype._registerClickToDismiss=function(){"use strict";var y=j.hasClass(k.find(this._composerRoot,"._yq"),"_519b");if(!y){this._clearClickDismissToken();return;}this._clickDismissToken=l.listen(document.body,'click',function(z){var aa=m.byClass(z.getTarget(),"_2wp");if(!aa){this._close();this._clearClickDismissToken();}}.bind(this));};x.prototype._clearClickDismissToken=function(){"use strict";if(this._clickDismissToken){this._clickDismissToken.remove();this._clickDismissToken=null;}};x.prototype._close=function(){"use strict";this._clearClickDismissToken();this._closeMLE();i.reset(this._composerRoot);};x.prototype._closeMLE=function(){"use strict";h.loadModules(["TimelineMLE"],function(y){var z=y.getFlyout();if(w(z)===this._composerRoot)y.hideFlyout();}.bind(this));};e.exports=x;},null);